<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ffp-generate</title>
    <meta name="description" content="description">
    <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,minimal-ui">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" />

    <style type="text/css">
      body {
        background-color: #333;
      }

      main {
        position: absolute;
        left: 50%;
        top: 50%;

        transform-origin: 0 0;
        transform:
          scale(1)
          translate(-50%, -50%);

        box-shadow: 0 0 100px rgba(black, 0.2);
      }
    </style>
  </head>
  <body>
    <main>
      <canvas/>
    </main>

    <script src="ffp-generate.umd.js"></script>
    <script>
      console.log(ffp)

      var prng = ffp.prng
      prng.seed = window.location.hash.substring(1) || Date.now()
      document.title += ' | ' + prng.seed
      console.log(+prng.seed)

      var swatch = prng.randomOf(Object.values(ffp.swatches))

      beginPerfCapture('generate')
      var landscape = ffp.generate({
        units: [8, 16],
        width: window.innerWidth - 100,
        height: window.innerHeight - 100,
        groundsLength: 30,

        percentOfStraightLines: 0.125,
        percentOfGradients: 0.5,
        percentOfSimplexGradients: 0.1,

        swatch: swatch,
        backgroundColor: prng.randomOf(swatch),

        symbols: [
          // 'debug',
          // 'empty',
          'square',
          'square_offset',
          'vertical_line',
          'vertical_line_offset',
          'horizontal_line',
          'horizontal_line_offset',
          'diagonal',
          'diamond',
          'circle',
          // 'ffp'
        ],

        canvas: document.querySelector('canvas'),
        random: prng.random
      })
      console.log(landscape)
      endPerfCapture('generate')

      beginPerfCapture('render')
      landscape.render()
      endPerfCapture('render')

      beginPerfCapture('mount')
      landscape.mount(document.querySelector('main'))
      endPerfCapture('mount')

      landscape.parent.style.width = landscape.width + 'px'
      landscape.parent.style.height = landscape.height + 'px'

      var erode = ffp.erode(landscape, {
        autoplay: false,
        easing: 0.09,
        noUpdateThreshold: 0.1,
        columnWidth: 16,
        snapToGrid: 8,
        breaks: 2,
        amplitude: [0, 100],
        scaleFactor: 1
      })

      landscape.parent.addEventListener('click', function (e) {
        erode.rebuild()
        erode.play()
      })

      window.addEventListener('keyup', function (e) {
        e.preventDefault()
        if (e.key === 's') return landscape.save(prng.seed, { type: 'image/png' })
        if (e.key === 'p') return landscape.save(prng.seed, { type: 'image/svg+xml' })
      })

      function beginPerfCapture (name) {
        window.captures = window.captures || {}
        window.captures[name] = performance.now()
      }

      function endPerfCapture (name)  {
        var end = performance.now()
        console.warn(`[${name}] ${(end - window.captures[name]).toFixed(0)}ms`)
        delete window.captures[name]
      }
    </script>
  </body>
</html>
